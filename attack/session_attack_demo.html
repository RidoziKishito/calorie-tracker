<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <title>Session Forgery Demo</title>
  <style>
    body { font-family: system-ui, Arial; margin: 40px; background: #f5f5f5; }
    .card { max-width: 800px; background: white; border-radius: 12px; padding: 32px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    code { background: #f0f0f0; padding: 4px 8px; border-radius: 4px; font-family: 'Courier New', monospace; }
    .step { margin: 20px 0; padding: 16px; background: #f9f9f9; border-left: 4px solid #e74c3c; }
    button { background: #e74c3c; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-size: 16px; }
    button:hover { background: #c0392b; }
    pre { background: #2c3e50; color: #ecf0f1; padding: 16px; border-radius: 6px; overflow-x: auto; }
    .warn { color: #e74c3c; font-weight: bold; }
  </style>
</head>
<body>
  <div class="card">
    <h2>üîì Session Forgery Attack Demo</h2>
    <p>Demo t·∫•n c√¥ng khi server d√πng <code>SECRET_KEY</code> m·∫∑c ƒë·ªãnh d·ªÖ ƒëo√°n.</p>

    <div class="step">
      <h3>B∆∞·ªõc 1: Chu·∫©n b·ªã m√¥i tr∆∞·ªùng</h3>
      <p>M·ªü file <code>.env</code>, comment d√≤ng SECRET_KEY:</p>
      <pre># SECRET_KEY="daAAKNKH..."</pre>
      <p>Restart server ‚Üí Server d√πng fallback: <code>"your-secret-key-here-change-in-production"</code></p>
    </div>

    <div class="step">
      <h3>B∆∞·ªõc 2: T·∫°o cookie gi·∫£</h3>
      <p>Ch·∫°y script Python:</p>
      <pre>cd "d:\3FIE\IT Project\calorie-tracker\attack"
python forge_session.py</pre>
      <p>Copy cookie t·ª´ output (chu·ªói d√†i base64-like).</p>
    </div>

    <div class="step">
      <h3>B∆∞·ªõc 3: Inject cookie v√†o browser</h3>
      <p>M·ªü <a href="http://127.0.0.1:8000" target="_blank">http://127.0.0.1:8000</a></p>
      <p>Nh·∫•n F12 ‚Üí Console ‚Üí Paste l·ªánh (thay COOKIE_HERE b·∫±ng cookie t·ª´ b∆∞·ªõc 2):</p>
      <pre>document.cookie = "session=COOKIE_HERE; path=/";
location.reload();</pre>
    </div>

    <div class="step">
      <h3>B∆∞·ªõc 4: X√°c minh</h3>
      <p>Sau khi reload, session ƒë√£ b·ªã chi·∫øm quy·ªÅn:</p>
      <ul>
        <li>‚úÖ <code>csrf_token</code> trong session b·ªã attacker ki·ªÉm so√°t</li>
        <li>‚úÖ C√≥ th·ªÉ bypass CSRF n·∫øu token l·∫•y t·ª´ session</li>
        <li>‚úÖ N·∫øu app l∆∞u <code>user_id</code> trong session ‚Üí chi·∫øm quy·ªÅn user</li>
      </ul>
    </div>

    <div class="step">
      <h3>K·∫øt qu·∫£</h3>
      <p class="warn">‚ö†Ô∏è Server ch·∫•p nh·∫≠n cookie gi·∫£ v√¨ secret key d·ªÖ ƒëo√°n!</p>
      <p>ƒêi·ªÅu n√†y cho ph√©p attacker:</p>
      <ul>
        <li>Gi·∫£ m·∫°o session data</li>
        <li>Bypass CSRF protection (n·∫øu token l∆∞u session)</li>
        <li>Chi·∫øm quy·ªÅn user (n·∫øu session ch·ª©a user_id)</li>
      </ul>
    </div>

    <hr />
    
    <h3>üõ°Ô∏è C√°ch ph√≤ng th·ªß</h3>
    <p>X√≥a fallback trong <code>main.py</code>:</p>
    <pre>secret_key = os.getenv("SECRET_KEY")
if not secret_key:
    raise RuntimeError("SECRET_KEY is required")

app.add_middleware(SessionMiddleware, secret_key=secret_key)</pre>
    
    <p class="warn">Lu√¥n ƒë·∫∑t SECRET_KEY m·∫°nh trong .env v√† kh√¥ng d√πng fallback!</p>
  </div>
</body>
</html>
